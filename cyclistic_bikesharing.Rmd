---
title: "Cyclictic Bike Sharing"
author: "Diji"
date: "12/19/2021"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Business task 

The primary goal of the company is to maximize the number of annual memberships.To facilitate this process, the marketing teams would like the following three questions answered: 

- How do annual members and casual riders use Cyclistic bikes differently?
- Why would casual riders buy Cyclistic annual memberships?
- How can Cyclistic use digital media to influence casual riders to become members?

The specific task given to me is to answer the question - how do annual members and casual riders use Cyclistic bikes differently?

# Data Sources

The data was downloaded from this link [here](https://divvy-tripdata.s3.amazonaws.com/index.html), and is the file that was updated on Dec 8, 2021. The data was made available by Motivate International Inc. 

# Analysis 

```{r message=FALSE, warning=FALSE}
# Import the packages 
if (!require(pacman)) {
  install.packgages(pacman)
}

pacman::p_load(janitor, skimr, tidyverse, data.table)
```



```{r include=FALSE}
bike_trips <- list.files(path = "C:/Users/diji.agberien/OneDrive - PayByPhone Technologies Inc/Documents/google_data_analytics_capstone_project_bike_share", pattern = "*.csv") %>% 
  map_df(~fread(., na.strings = c("", NA)))
```

# Summary 

```{r}
# Get a summary of the table 
skimr::skim(bike_trips)
```

The Data Summary table above provides a general description of the data. There are 13 columns; 7 of character type, 4 of numeric type, and 2 of POSIXct i.e. datetime type. These variables are of appropriate format for analysis. The table contains missing data as shown in the "n_missing" column. 

From the table above, the ride_id seems to be the unique identifier for the trips given the number of rows in the table and the no of ride ids. The unique types of bike rides are: `r unique(bike_trips$rideable_type)`. The types of members are `r unique(bike_trips$member_casual)`, and is primary in answering our question of how the different member types utilize Cyclistic. 

Some bits of information to evaluate differences between the two groups - members and casuals - include 

- the duration of trips
- the distribution of trip count among different temporal granularity e.g.days of the week, and months of the year. 
- ride type preferences
- the locations where the different membership types emanate from 
- view combinations to answer questions such as what bike type do the different member groups prefer at location A. 

# How do the different bike groups differ based on the duration of trips 

```{r}
bike_trips %>%
  select(member_casual, started_at, ended_at) %>% 
  mutate(duration = ended_at - started_at) %>%
  group_by(member_casual) %>%
  summarise(min_duration = min(duration), median_duration = median(duration), average_duration = mean(duration), stdev_duration = sd(duration), max_duration = max(duration))
```

From the above, we see the presence of negative duration. As this does not make any logical sense, we will exclude the trips of negative duration. As mentioned above, there are also trips with missing information such as start and end station names. These trips will not be excluded (yet) from analysis because although they fail to inform on the spatial use of Cyclistic, they do inform on the temporal use. In a real life scenario, the team will investigate the presence of these null values as they may be erroneous data or data from software testing etc.  

To further evaluate if these null values should be excluded, we can compare summary statistics of both cases. 

```{r}
# Get clean data 
bike_trips_clean <- bike_trips %>% 
  mutate(duration = ended_at - started_at) %>%
  filter(duration > 0)
```

When negative durations are dropped, the no of trips reduces from `r nrow(bike_trips)` to `r nrow(bike_trips_clean)` i.e it reduces by `r 1 - ((nrow(bike_trips_clean)/nrow(bike_trips))*100)`

```{r}
# Summary statistics without NAs present 
bike_trips_clean %>% 
  drop_na() %>% 
  mutate(duration = ended_at - started_at) %>%
  group_by(member_casual) %>%
  summarise(min_duration = min(duration), median_duration = median(duration), average_duration = mean(duration), stdev_duration = sd(duration), max_duration = max(duration))
```

```{r}
# Summary statistics with NAs present
bike_trips_clean %>% 
  mutate(duration = ended_at - started_at) %>%
  group_by(member_casual) %>%
  summarise(min_duration = min(duration), median_duration = median(duration), average_duration = mean(duration), stdev_duration = sd(duration), max_duration = max(duration))
```

```{r}
# Print the number of rows if NAs are dropped
bike_trips_clean %>% 
  drop_na() %>% 
  nrow()
```

Comparing the summary statistics with and without the NAs, we observe ever slight differences between both cases. If we were to drop the rows the missing data, we'd be left with 4525274 rows, which is a `r (1-(4525274/5479096))*100`% decrease in the data. Based on the above information, we will not be excluding the NAs from the data set, as additionally, it does not hinder us from attaining information from locations with labels. 

```{r}
# Box-plot data for trips with and without outliers 
trips_w_outliers <- boxplot(duration ~ member_casual, data = bike_trips_clean, outline = T, main = "Distribution of trip duration for members and casuals", xlab = "Group", ylab = "Duration")
trips_wo_outliers <- boxplot(duration ~ member_casual, data = bike_trips_clean, outline = F, main = "Distribution of trip duration for members and casuals (without outliers)", xlab = "Group", ylab = "Duration")
```

Noteworthy information from the visual above is that casuals tend to have longer trips than members. 

```{r}
# Print out summary statistics
trips_wo_outliers$stats
```

```{r}
# How many rows will there be if outliers were excluded 
bike_trips_clean %>% 
  filter(duration <= 3601) %>% 
  nrow()
```

If we exclude outliers, we'd be left with approximately 95% of our data, as such, we will proceed to exclude outliers from our analysis. 

```{r}
# Exclude outliers from the dataset 
bike_trips_clean <- bike_trips_clean %>% 
  filter(duration <= 3601)
```

```{r}
# Duration summary with outlier excluded 
bike_trips_clean %>% 
  group_by(member_casual) %>%
  summarise(min_duration = min(duration), median_duration = median(duration), average_duration = mean(duration), stdev_duration = sd(duration), max_duration = max(duration))
```

Now that outliers have been excluded, we will proceed to do further analysis and visualizations in Tableau. 

# Visualizations and key findings

```{r trip_insight, echo=FALSE, fig.cap="Trip insights", out.width="100%"}
knitr::include_graphics("C:/Users/diji.agberien/OneDrive - PayByPhone Technologies Inc/Documents/google_data_analytics_capstone_project_bike_share/trip_dashboard.PNG")
```

# Insights 

- Most trips occur within the Chicago area
- Casual users mostly utilize cyclistic during the weekend while members mostly utilize Cyclistic during the weekday 
- Regardless of whether the user is a Casual or Member, Cyclistic is mostly utilized during the summer. 

# Recommendations 

A possible technique to increase membership could be to run campaigns or marketing initiatives for casual members during the weekend of the summer months.